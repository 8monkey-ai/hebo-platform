// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider   = "prisma-client"
  output     = "../src/generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model Users {
  id            String        @id
  name          String
  email         String
  emailVerified Boolean       @default(false)
  image         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  sessions      Sessions[]
  accounts      Accounts[]
  apikeys       Apikeys[]
  teammembers   TeamMembers[]
  members       Members[]
  invitations   Invitations[]

  @@unique([email])
  @@map("users")
}

model Sessions {
  id                   String   @id
  expiresAt            DateTime
  token                String
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  ipAddress            String?
  userAgent            String?
  userId               String
  users                Users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  activeOrganizationId String?
  activeTeamId         String?

  @@unique([token])
  @@index([userId])
  @@map("sessions")
}

model Accounts {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  users                 Users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("accounts")
}

model Verifications {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verifications")
}

model Apikeys {
  id                  String    @id
  name                String?
  start               String?
  prefix              String?
  key                 String
  userId              String
  users               Users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  refillInterval      Int?
  refillAmount        Int?
  lastRefillAt        DateTime?
  enabled             Boolean?  @default(true)
  rateLimitEnabled    Boolean?  @default(true)
  rateLimitTimeWindow Int?      @default(3600000)
  rateLimitMax        Int?      @default(3600)
  requestCount        Int?      @default(0)
  remaining           Int?
  lastRequest         DateTime?
  expiresAt           DateTime?
  createdAt           DateTime
  updatedAt           DateTime
  permissions         String?
  metadata            String?

  @@index([key])
  @@index([userId])
  @@map("apikeys")
}

model Organizations {
  id          String        @id
  name        String
  slug        String
  logo        String?
  createdAt   DateTime
  metadata    String?
  teams       Teams[]
  members     Members[]
  invitations Invitations[]

  @@unique([slug])
  @@map("organizations")
}

model Teams {
  id             String        @id
  name           String
  organizationId String
  organizations  Organizations @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdAt      DateTime
  updatedAt      DateTime?     @updatedAt
  agentSlug      String
  teammembers    TeamMembers[]

  @@index([organizationId])
  @@map("teams")
}

model TeamMembers {
  id        String    @id
  teamId    String
  teams     Teams     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  userId    String
  users     Users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime?

  @@index([teamId])
  @@index([userId])
  @@map("teamMembers")
}

model Members {
  id             String        @id
  organizationId String
  organizations  Organizations @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  userId         String
  users          Users         @relation(fields: [userId], references: [id], onDelete: Cascade)
  role           String        @default("member")
  createdAt      DateTime

  @@index([organizationId])
  @@index([userId])
  @@map("members")
}

model Invitations {
  id             String        @id
  organizationId String
  organizations  Organizations @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  email          String
  role           String?
  teamId         String?
  status         String        @default("pending")
  expiresAt      DateTime
  createdAt      DateTime      @default(now())
  inviterId      String
  users          Users         @relation(fields: [inviterId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([email])
  @@map("invitations")
}
